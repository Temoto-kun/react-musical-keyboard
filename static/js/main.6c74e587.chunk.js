(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,n){e.exports=n(36)},23:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var r=n(2),o=n(0),u=n(13),i=n.n(u),a=(n(23),n(7)),c=n.n(a),l=n(14),s=n(15),f=n(3),d=n(16),b=n(1);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach(function(t){y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function m(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},u=Object.keys(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(c){o=!0,u=c}finally{try{r||null==a.return||a.return()}finally{if(o)throw u}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var w=function(e){var t=e.id%12,n=[0,2,4,5,7,9,11].indexOf(t);return-1===n?null:n},j=Object(o.forwardRef)(function(e,t){var n,r,u,i,a,c,l,s,f,d,b=e.startKey,g=void 0===b?9:b,j=e.endKey,E=void 0===j?96:j,k=e.style,K=void 0===k?{}:k,M=e.onKeyOn,S=void 0===M?null:M,x=e.onKeyOff,D=void 0===x?null:x,C=e.labels,P=void 0===C?null:C,L=e.keyboardMapping,A=void 0===L?null:L,H=e.accidentalKeyHeight,I=void 0===H?"60%":H,R=e.keyboardVelocity,T=void 0===R?.75:R,z=e.keysOn,B=void 0===z?[]:z,N=e.naturalKeyStyle,U=void 0===N?function(){return{}}:N,W=e.accidentalKeyStyle,F=void 0===W?function(){return{}}:W,V=e.orientation,q=void 0===V?"normal":V,G=m(e,["startKey","endKey","style","onKeyOn","onKeyOff","labels","keyboardMapping","accidentalKeyHeight","keyboardVelocity","keysOn","naturalKeyStyle","accidentalKeyStyle","orientation"]),J=t||Object(o.useRef)(null),X=O(Object(o.useState)([]),2)[1],Y=O(Object(o.useState)({}),2),Q=Y[0],Z=Y[1],$=O(Object(o.useState)({}),2),_=$[0],ee=$[1],te=Object.entries(Q);switch(q){default:case"normal":r="height",u="width",i="row",a="top",c="left",l="marginLeft",s="marginRight",f="clientY",d="offsetHeight";break;case"rotate-180":r="height",u="width",i="row-reverse",a="bottom",c="right",l="marginRight",s="marginLeft",f="clientY",d="offsetHeight";break;case"rotate-90":r="width",u="height",i="column-reverse",a="left",c="bottom",l="marginBottom",s="marginTop",f="clientX",d="offsetWidth";break;case"rotate-270":r="width",u="height",i="column",a="right",c="top",l="marginTop",s="marginBottom",f="clientX",d="offsetWidth"}var ne=function(e){return function(t,n){var r=J.current,o=void 0===r?null:r;S&&null!==o&&S({target:p({},o,{value:p({},t,{velocity:n})}),source:e})}},re=Object(o.useCallback)(function(e){return function(t){var n=J.current,r=void 0===n?null:n;D&&null!==r&&D({target:p({},r,{value:t}),source:e})}},[D]),oe=function(e){return function(t){1===t.buttons&&re("mouse")(e)}},ue=function(e){return function(t){var n=t.buttons,r=t[f],o=t.target[d],u=r-J.current.getBoundingClientRect()[a];1===n&&ne("mouse")(e,u/o)}},ie=function(e){return function(t){var n=t.buttons,r=t[f],o=t.target[d],u=J.current,i=r-u.getBoundingClientRect()[a];1===n&&(t.preventDefault(),u.focus(),ne("mouse")(e,i/o))}},ae=function(e){return function(t){t.preventDefault(),re("mouse")(e)}},ce=function(e){return Array.isArray(B)&&B.includes(e.id)};Object(o.useEffect)(function(){for(var e={},t={},n=g;n<=E;n+=1){var r=Math.floor(n/12);r in e||(e[r]=[]),t[n]={id:n,octave:r},e[r].push(t[n])}Z(e),ee(t)},[g,E]),Object(o.useEffect)(function(){var e=function(e){var t=e.altKey,n=e.shiftKey,r=e.ctrlKey,o=e.metaKey,u=e.keyCode;t||n||r||o||A&&A[u]&&(e.preventDefault(),X(function(e){var t=A[u];return null!==A&&t&&re(!1)({id:t}),e.filter(function(e){return e!==u})}))};return window.addEventListener("keyup",e,!0),function(){window.removeEventListener("keyup",e,!0)}},[A,re]);var le=Object.values(Q).reduce(function(e,t){return[].concat(h(e),h(t))},[]).filter(function(e){return null!==w(e)});return Object(o.createElement)("div",v({},G,{style:p((n={},y(n,u,"100%"),y(n,r,100),y(n,"minHeight","rotate-90"===q||"rotate-270"===q?"100vw":null),n),K,{lineHeight:0,backgroundColor:"currentColor",boxSizing:"border-box",overflow:"hidden",display:"flex",flexDirection:i}),ref:J,tabIndex:0,onKeyDown:function(e){var t=e.altKey,n=e.shiftKey,r=e.ctrlKey,o=e.metaKey,u=e.keyCode;t||n||r||o||A&&A[u]&&(e.preventDefault(),X(function(e){if(e.includes(u))return e;var t=A[u];return null!==A&&t&&ne("keyboard")(_[t],T),[].concat(h(e),[u])}))}}),te.map(function(e,t,n){var f,d=O(e,2),b=d[0],v=d[1];return Object(o.createElement)("div",{key:b,style:(f={},y(f,u,0),y(f,"flex","auto"),y(f,"boxSizing","border-box"),y(f,r,"100%"),y(f,"position","relative"),y(f,l,0!==t?null:"".concat((7-v.filter(function(e){return null!==w(e)}).length)/(w(v[0])?le.length:le.length-1)*-100,"%")),y(f,s,t!==n.length-1?null:"".concat((7-v.filter(function(e){return null!==w(e)}).length)/(w(v.slice(-1)[0])?le.length:le.length-1)*-100,"%")),f)},v.map(function(e){var t,n;return Object(o.createElement)("div",{key:e.id,style:(t={position:"absolute",boxSizing:"border-box"},y(t,a,0),y(t,c,null!==w(e)?"".concat(w(e)/7*100,"%"):"".concat(e.id%12/12*100,"%")),y(t,u,null!==w(e)?"".concat(100/7,"%"):"".concat(100/12,"%")),y(t,r,null!==w(e)?"100%":I),y(t,"zIndex",null!==w(e)?0:1),t),onMouseDown:ie(e),onMouseEnter:ue(e),onMouseLeave:oe(e),onMouseUp:ae(e)},Object(o.createElement)("div",{style:p({},null!==w(e)?U(ce(e)):F(ce(e)),{width:"100%",height:"100%",boxSizing:"border-box"})}),null!==P&&Object(o.createElement)("div",{style:(n={},y(n,u,"100%"),y(n,r,I),y(n,"position","absolute"),y(n,a,"50%"),y(n,c,0),y(n,"display","flex"),y(n,"flexDirection",i),y(n,"justifyContent","center"),y(n,"alignItems","center"),y(n,"filter",null!==w(e)?null:"invert(100%)"),y(n,"fontSize","1vw"),y(n,"pointerEvents","none"),n)},Object(o.createElement)("div",{style:{transform:null===w(e)&&"normal rotate-180".split(" ").includes(q)?"rotate(90deg)":null}},P(e))))}))}))});j.propTypes={startKey:b.number,endKey:b.number,style:b.object,onKeyOn:b.func,onKeyOff:b.func,labels:b.func,keyboardMapping:b.object,accidentalKeyHeight:Object(b.oneOfType)([b.string,b.number]),keyboardVelocity:b.number,naturalKeyStyle:b.func,accidentalKeyStyle:b.func,orientation:Object(b.oneOf)(["normal","rotate-90","rotate-180","rotate-270"]),keysOn:Object(b.arrayOf)(b.number)};var E=j,k=function(e,t,n){return n*Math.pow(Math.pow(2,1/12),e-t)},K="C C# D D# E F F# G G# A A# B".split(" "),M=function(e){var t=e.startKey,n=void 0===t?21:t,u=e.endKey,i=void 0===u?108:u,a=e.sound,b=void 0===a?0:a,y=e.generator,v=void 0===y?null:y,g=e.keyboardMapping,p=void 0===g?{}:g,m=o.useState(!1),O=Object(r.a)(m,1)[0],h=o.useState(b),w=Object(r.a)(h,2),j=w[0],M=w[1],S=o.useState(!1),x=Object(r.a)(S,2),D=x[0],C=x[1],P=o.useState(!1),L=Object(r.a)(P,2),A=L[0],H=L[1],I=o.useState(!1),R=Object(r.a)(I,2),T=R[0],z=R[1],B=o.useState([]),N=Object(r.a)(B,2),U=N[0],W=N[1],F=o.useState(window.innerWidth),V=Object(r.a)(F,2),q=V[0],G=V[1],J=o.useState(window.innerHeight),X=Object(r.a)(J,2),Y=X[0],Q=X[1],Z=o.useState([]),$=Object(r.a)(Z,2)[1],_=o.useState(null),ee=Object(r.a)(_,2)[1],te=o.useRef(null),ne=o.useRef(null),re=o.useRef(null),oe=o.useRef(null),ue=o.useRef(null),ie=o.useRef(null),ae=function(){window.setTimeout(function(){var e=ie.current,t=void 0===e?null:e;null!==t&&t.focus()})},ce=function(){C(0),ae()},le=function(){H(0),ae()},se=function(){z(0),ae()};return o.useEffect(function(){"sendMessage"in v&&v.sendMessage(64,D)},[D,v]),o.useEffect(function(){"sendMessage"in v&&v.sendMessage(66,A)},[A,v]),o.useEffect(function(){"sendMessage"in v&&v.sendMessage(67,T)},[T,v]),o.useEffect(function(){v.changeSound(j),ne.current.value=j},[j,v]),o.useEffect(function(){ae()},[]),o.useEffect(function(){var e=function(e){e.preventDefault(),e.stopPropagation()},t=function(){var e=Object(s.a)(c.a.mark(function e(t){var n,o,u,i,a,s,b,y;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),t.stopPropagation(),n=t.dataTransfer.files,o=Object(r.a)(n,1),u=o[0],null!==te.current&&(window.clearInterval(te.current),"sendMessage"in v&&(v.sendMessage(120,0),v.sendMessage(121,0),W([]))),"audio/mid"===u.type){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,u.arrayBuffer();case 9:i=e.sent,a=new d.Midi(i),console.log(a),s=Object(f.a)(a.tracks.reduce(function(e,t,n){return[].concat(Object(f.a)(e),Object(f.a)(t.notes.map(function(e){return[[e.ticks,n,"noteOn",e.midi,e.velocity],[e.ticks+e.durationTicks,n,"noteOff",e.midi,e.velocity]]})),[Object.keys(t.controlChanges).map(function(e){return Number(e)}).filter(function(e){return![7,10].includes(e)}).reduce(function(e,r){return[].concat(Object(f.a)(e),Object(f.a)(t.controlChanges[r].map(function(e){return[e.ticks,n,r,e.value]})))},[])])},[])).reduce(function(e,t){return[].concat(Object(f.a)(e),Object(f.a)(t))},[]).sort(function(e,t){return e[0]-t[0]}),b=0,y=s,te.current=window.setInterval(function(){b+=a.header.ppq/96,y.filter(function(e){return e[0]<=b}).forEach(function(e){var t=Object(l.a)(e),n=t[2],r=t.slice(3);switch(n){case"noteOn":v.soundOn(r[0],127*r[1],k(r[0],69,440)),W(function(e){return[].concat(Object(f.a)(e),[r[0]])});break;case"noteOff":v.soundOff(r[0]),W(function(e){return e.filter(function(e){return e!==r[0]})});break;default:"sendMessage"in v&&v.sendMessage(n,r[0])}}),y=s.filter(function(e){return e[0]>b}),b>a.durationTicks&&(window.clearInterval(te),"sendMessage"in v&&(v.sendMessage(120,0),v.sendMessage(121,0),W([])))});case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n=function(e){var t=e.target,n=t.innerWidth,r=t.innerHeight;G(n),Q(r)};return window.document.body.addEventListener("dragover",e),window.document.body.addEventListener("drop",t),window.addEventListener("resize",n),function(){window.document.body.removeEventListener("dragover",e),window.document.body.removeEventListener("drop",t),window.removeEventListener("resize",n)}},[v]),o.createElement(o.Fragment,null,o.createElement("div",{className:"topbar"},o.createElement("div",{className:"group"},o.createElement("label",{className:"sound"},o.createElement("span",{className:"label"},"Sound"),o.createElement("select",{className:"input",name:"sound",onChange:function(e){M(e.target.value),ae()},ref:ne},v.getSounds().map(function(e,t){return o.createElement("option",{key:t,value:t},e)}))))),"sendMessage"in v&&o.createElement("div",{className:"pedals"},o.createElement("button",{type:"button",ref:ue,onMouseDown:function(){z(127),ae()},onMouseUp:se,onMouseLeave:se},"Una Corda"),o.createElement("button",{type:"button",ref:oe,onMouseDown:function(){H(127),ae()},onMouseUp:le,onMouseLeave:le},"Sostenuto"),o.createElement("button",{type:"button",ref:re,onMouseDown:function(){C(127),ae()},onMouseUp:ce,onMouseLeave:ce},"Sustain")),o.createElement(E,{ref:ie,labels:function(e){return O?"".concat(K[e.id%12]).concat(Math.floor(e.id/12)-1):null},onKeyOn:function(e){var t=e.source,n=e.target.value,r=n.id,o=n.velocity;"mouse"===t&&$(function(e){return[].concat(Object(f.a)(e),[r])}),W(function(e){return[].concat(Object(f.a)(e),[r])}),ee(function(e){var n=null!==e?e:o;return v.soundOn(r,127*("mouse"===t?n:o),k(r,69,440)),"mouse"===t?n:e})},onKeyOff:function(e){var t=e.source,n=e.target.value.id;W(function(e){return e.filter(function(e){return e!==n})}),"mouse"===t&&window.setTimeout(function(){$(function(e){var t=e.filter(function(e){return e!==n});return ee(function(e){return t.length>0?e:null}),t})}),v.soundOff(n)},startKey:n,endKey:i,accidentalKeyHeight:"65%",keyboardMapping:p,orientation:q<Y?"rotate-90":"normal",style:{height:q<Y?"100%":"5vw",width:q<Y?"5vh":"100%",color:"#000",outline:"none",position:"absolute",bottom:0,left:0},naturalKeyStyle:function(e){return{backgroundColor:e?"Highlight":"white",border:"1px solid"}},accidentalKeyStyle:function(e){return{backgroundColor:e?"Highlight":"currentColor",border:"1px solid"}},keysOn:U}))},S={81:60,50:61,87:62,51:63,69:64,82:65,53:66,84:67,54:68,89:69,55:70,85:71,73:72,57:73,79:74,48:75,80:76,219:77,61:78,187:78,221:79,90:48,83:49,88:50,68:51,67:52,86:53,71:54,66:55,72:56,78:57,74:58,77:59,188:60,76:61,190:62,59:63,186:63,191:64};Promise.all([n.e(3).then(n.bind(null,37)),n.e(4).then(n.bind(null,38))]).then(function(e){var t=Object(r.a)(e,2),n=t[0],u=t[1].default;"requestMIDIAccess"in window.navigator&&(u=n.default),i.a.render(o.createElement(M,{generator:new u,keyboardMapping:S,startKey:0,endKey:127}),window.document.getElementById("root"))})}},[[17,1,2]]]);
//# sourceMappingURL=main.6c74e587.chunk.js.map